{"version":3,"sources":["../../src/bin/swizzle-cli.js"],"names":["rc","loadRcConfig","rcFiles","getRcFilePathsIfExists","conf","loadSwizzleConfig","file","swizzle","version","command","alias","description","option","action","options","console","log","generated","name","desc","defaultValue","param","addParam","samples","removeParam","state","params","find","p","files","addFiles","removeFiles","isDefault","swizzleStackInit","swizzleStackConfig","swizzleStack","verbose","clean","parse","process","argv","getValue","value","toUpperCase","paramName","filter","map","join"],"mappings":"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","file":"swizzle-cli.js","sourcesContent":["\nimport program from 'commander'\nimport {sfs} from '../file-system'\nimport {SwizzleConfig} from '../config'\nimport {Swizzle} from '../swizzle'\nimport snakeCase from 'lodash.snakecase'\n\n// only uses ~/.swizzlerc or ./.swizzlerc\nconst rc = sfs.loadRcConfig({rcFiles: sfs.getRcFilePathsIfExists()})\nconst conf = new SwizzleConfig(sfs.loadSwizzleConfig({file: './swizzle.json', rc}))\nconst swizzle = new Swizzle(conf, sfs)\n\nprogram\n\t.version('0.0.1')\n\nprogram\n\t.command('add-param')\n\t.alias('ap')\n\t.description('add a parameter to swizzle.json')\n\t.option('-g, --generated', 'generated parameter so do not prompt user')\n\t.option('-n, --name <name>', 'name of parameter to add')\n\t.option('-d, --desc <desc>', 'description of parameter')\n\t.option('-v, --default-value <defaultValue>', 'default value of parameter')\n\t.action((options) => {\n\n\t\tconsole.log(`add-param %s--name '%s' --desc %s --default-value %s`,\n\t\t\toptions.generated ? '-g ' : '',\n\t\t\toptions.name,\n\t\t\toptions.desc,\n\t\t\toptions.defaultValue)\n\n\t\tconst param = {\n\t\t\tname: options.name,\n\t\t\tdesc: options.desc,\n\t\t\tdefaultValue: options.defaultValue\n\t\t}\n\n\t\tif (options.generated) {\n\t\t\tparam.generated = true\n\t\t}\n\n\t\tswizzle.addParam(param)\n\n\t\tconsole.log(samples())\n\n\t})\n\n\nprogram\n\t.command('remove-param')\n\t.alias('rp')\n\t.description('remove a parameter from swizzle.json')\n\t.option('-n, --name <name>', 'name of parameter to remove')\n\t.action((options) => {\n\n\t\tconsole.log(`remove-param --name '%s'`, options.name)\n\n\t\t// todo notify which code files use this param\n\n\t\tconst param = {\n\t\t\tname: options.name\n\t\t}\n\n\t\tconst removeParam = conf.state.params.find((p) => p.name === param.name)\n\n\t\tif (!removeParam) {\n\t\t\tconsole.log('param name is not found in swizzle.json', param.name)\n\t\t\treturn\n\t\t}\n\n\t\tconsole.log('be sure to remove this param from any code files to minimize errors.')\n\t\tconsole.log(samples(param.name))\n\n\t\tswizzle.removeParam(param)\n\n\t})\n\nprogram\n\t.command('add-files [files...]')\n\t.alias('af')\n\t.description('add code files to swizzle.json')\n\t.action((files) => {\n\n\t\tconsole.log('add-files %s', files)\n\n\t\tswizzle.addFiles({files})\n\n\t\tconsole.log('add the parameters needed in each code file:')\n\t\tconsole.log(samples())\n\t\tconsole.log('then run `swizzle stack <stack-name>` to enter parameters')\n\t\tconsole.log('and swizzle the configuration values in your code files.')\n\n\t})\n\nprogram\n\t.command('remove-files [files...]')\n\t.alias('rf')\n\t.description('remove code files from swizzle.json')\n\t.action((files) => {\n\n\t\tconsole.log('files %s', files)\n\n\t\tif (typeof files === 'string') {\n\t\t\tfiles = [files]\n\t\t}\n\n\t\tswizzle.removeFiles({files})\n\n\t})\n\nprogram\n\t.command('init', {isDefault: true})\n\t.alias('i')\n\t.description('prompt for stack name, prompt for missing parameters, swizzle code files')\n\t.option('-e, --edit-first', 'review and edit stack parameter values, swizzle code files')\n\t.option('-s, --use-rc', 'save stack param values in the .swizzlerc file')\n\t.option('-f, --file <file>', 'save stack param values in the given file')\n\t.action((options) => {\n\t\tswizzle.swizzleStackInit(options)\n\t})\n\nprogram\n\t.command('config', {isDefault: true})\n\t.alias('c')\n\t.description('continue with current stack name, prompt for missing parameters, swizzle code files')\n\t.option('-e, --edit-first', 'review and edit stack parameter values, swizzle code files')\n\t.option('-s, --use-rc', 'save stack param values in the .swizzlerc file')\n\t.option('-f, --file <file>', 'save stack param values in the given file')\n\t.action((options) => {\n\t\tswizzle.swizzleStackConfig(options)\n\t})\n\nprogram\n\t.command('stack <name>')\n\t.alias('s')\n\t.description('use given stack name, prompt for missing parameter values, swizzle code files')\n\t.option('-e, --edit-first', 'review and edit stack parameter values, swizzle code files')\n\t.option('-s, --use-rc', 'save stack param values in the .swizzlerc file')\n\t.option('-f, --file <file>', 'save stack param values in the given file')\n\t.action((name, options) => {\n\t\tswizzle.swizzleStack(name, options)\n\t})\n\nprogram\n\t.command('clean')\n\t.alias('c')\n\t.description('un-swizzle parameter values back to defaultValue and remove all stacks')\n\t.option('-v, --verbose', 'additional logging')\n\t.action((options) => {\n\t\tconst params = {\n\t\t\tverbose: options.verbose\n\t\t}\n\t\tswizzle.clean(params)\n\t})\n\nprogram.parse(process.argv)\n\nfunction getValue(param) {\n\tif (param.defaultValue) {\n\t\treturn param.defaultValue\n\t}\n\tconst value = param.description || param.name\n\treturn snakeCase('Your_' + value).toUpperCase()\n}\n\nfunction samples(paramName) {\n\tconst params = conf.state.params.filter((p) => paramName ? p.name === paramName : true).map((param) => {\n\t\tconst value = getValue(param)\n\t\treturn `\\n\\t\\t\"${param.name}\": \"${value}\"`\n\t}).join(',')\n\treturn `\\t{${params}\\n\\t}`\n}\n"]}